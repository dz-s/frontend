(this.webpackJsonpundefined=this.webpackJsonpundefined||[]).push([[0],{22:function(t,e,n){t.exports=n(34)},27:function(t,e,n){},34:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),o=n(17),i=n.n(o),s=(n(27),n(15)),u=n(1),c=n.n(u),l=n(3),h=n(2),p=n(6),f=n(8),d=n(7),m=n(10),v=n(9),b=n(14),y=n.n(b),g=n(4),k=n(5);function O(){var t=Object(g.a)(["\n  display: inline-block;\n  color: hotpink;\n  letter-spacing: 1px;\n  margin-right: 1rem;\n"]);return O=function(){return t},t}function w(){var t=Object(g.a)(["\n  height: 100%;\n  width: 100%;\n  display: block;\n  margin: 0 auto;\n  text-align: center;\n  overflow: hidden;\n"]);return w=function(){return t},t}var j=k.a.div(w()),x=k.a.div(O());function C(){var t=Object(g.a)(['\n  font-family: "Roboto", sans-serif;\n']);return C=function(){return t},t}function E(){var t=Object(g.a)(["\n  position: relative;\n  margin-left: auto;\n  margin-right: auto;\n  margin-top: 2.5vh;\n"]);return E=function(){return t},t}var P=k.a.div(E()),S=k.a.div(C()),D=function(){function t(){Object(h.a)(this,t)}return Object(p.a)(t,null,[{key:"fetchSize",value:function(){var t=Object(l.a)(c.a.mark((function t(e){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://cors.x7.workers.dev/".concat(e),{method:"HEAD"});case 2:return n=t.sent,r=n.headers.get("content-length"),t.abrupt("return",parseInt(r));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"formatSize",value:function(t){if(0===t)return"0 Bytes";var e=Math.floor(Math.log(t)/Math.log(1e3));return"".concat(parseFloat((t/Math.pow(1e3,e)).toFixed(2))," ").concat(["Bytes","KB","MB"][e])}}]),t}(),L=function(t){function e(t){var n;return Object(h.a)(this,e),(n=Object(f.a)(this,Object(d.a)(e).call(this,t))).ref=void 0,n.ref=a.a.createRef(),n.state={autoplay:!1,volume:1,size:0},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"getVideoNode",value:function(){return this.ref.current}},{key:"onVolumeChange",value:function(){var t=this.getVideoNode();t&&(t.muted?this.setState({volume:0}):this.setState({volume:t.volume}))}},{key:"componentDidUpdate",value:function(){var t=Object(l.a)(c.a.mark((function t(e){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.media.full!==this.props.media.full){t.next=2;break}return t.abrupt("return");case 2:return this.props.playing&&!this.state.autoplay&&this.setState({autoplay:!0}),t.t0=this,t.next=6,D.fetchSize(this.props.media.full);case 6:if(t.t1=t.sent,t.t2={size:t.t1},t.t0.setState.call(t.t0,t.t2),n=this.getVideoNode()){t.next=12;break}return t.abrupt("return");case 12:this.props.playing?n.play():n.pause(),n.volume=this.state.volume;case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var t=Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this,t.next=3,D.fetchSize(this.props.media.full);case 3:t.t1=t.sent,t.t2={size:t.t1},t.t0.setState.call(t.t0,t.t2);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return a.a.createElement(P,null,a.a.createElement("video",{playsInline:!0,ref:this.ref,key:this.props.media.full,controls:!0,autoPlay:this.state.autoplay,loop:this.props.looping,muted:!1,preload:"auto",onPlay:function(){return t.props.onPlay()},onPause:function(){return t.props.onPause()},onEnded:function(){return t.props.moveCursor(1)},onError:function(){return t.props.moveCursor(1)},onVolumeChange:function(){return t.onVolumeChange()},poster:this.props.media.thumbnail,style:{maxHeight:"70vh",minHeight:"40vh",maxWidth:"90vw",borderRadius:"5px"}},a.a.createElement("source",{src:this.props.media.full})),a.a.createElement(S,null,this.props.media.name," | ",D.formatSize(this.state.size)),a.a.createElement(S,null,a.a.createElement("a",{href:"https://www.google.com/searchbyimage?image_url=".concat(this.props.media.thumbnail),target:"_blank",style:{textDecoration:"none"}},"\ud83d\udd0e")))}}]),e}(a.a.Component);function z(){var t=Object(g.a)(["\n  color: hotpink;\n  letter-spacing: 1px;\n  margin-right: 1rem;\n  display: inline-block;\n\n  &:hover {\n    color: orange;\n  }\n  &:link {\n    color: hotpink;\n  }\n  &:visited {\n    color: red;\n  }\n"]);return z=function(){return t},t}function I(){var t=Object(g.a)(["\n  text-align: center;\n  position: fixed;\n  bottom: 5vh;\n  left: 50%;\n  transform: translateX(-50%);\n"]);return I=function(){return t},t}var M=k.a.div(I()),V=k.a.div(z()),N=function(t){function e(t){var n;return Object(h.a)(this,e),(n=Object(f.a)(this,Object(d.a)(e).call(this,t))).state={},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this;return a.a.createElement(M,null,a.a.createElement(V,null,a.a.createElement("span",{onClick:function(){return t.props.moveCursor(-1)}},"\u25c0")),a.a.createElement(V,null,"|"),a.a.createElement(V,null,a.a.createElement("span",{onClick:function(){return t.props.moveCursor(1)}},"\u25b6")),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement(V,null,a.a.createElement("span",{onClick:function(){return t.props.toggleLoop()},style:{color:this.props.looping?"hotpink":"orange"}},this.props.looping?"LOOPING":"LOOP")),a.a.createElement(V,null,a.a.createElement("a",{href:this.props.source,download:!0,target:"_blank",style:{color:"hotpink",textDecoration:"none"}},"DOWNLOAD")))}}]),e}(a.a.Component),B=function t(e,n,r,a){Object(h.a)(this,t),this.full=void 0,this.thumbnail=void 0,this.kind=void 0,this.name=void 0,this.full=e,this.thumbnail=n,this.kind=r,this.name=a},F=function t(e){Object(h.a)(this,t),this.id=void 0,this.id=e},A="https://cors.x7.workers.dev",R="https://one.karasique.io",T="b",H=function(t){function e(t){var n;return Object(h.a)(this,e),(n=Object(f.a)(this,Object(d.a)(e).call(this,t))).state={playing:!1,looping:!0,board:T,threads:[],threadsCursor:0,playlist:[],playlistCursor:0,isIOS:!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)},document.addEventListener("keydown",n.handleKeyDown.bind(Object(m.a)(n))),n.fetchThreads(n.state.board).then((function(t){return n.setState({threads:t}),n.continuousPreload()})),n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"handleKeyDown",value:function(t){if("VIDEO"!==t.target.tagName)switch(t.code){case"ArrowLeft":this.moveCursor(-1);break;case"ArrowRight":this.moveCursor(1);break;case"Space":this.state.playing?this.onPause():this.onPlay()}}},{key:"onPlay",value:function(){this.setState({playing:!0})}},{key:"onPause",value:function(){this.setState({playing:!1})}},{key:"moveCursor",value:function(t){var e=this.state.playlistCursor+t;e<0||e>=this.state.playlist.length||this.setState({playlistCursor:e})}},{key:"toggleLoop",value:function(){this.setState({looping:!this.state.looping})}},{key:"fetchThreads",value:function(){var t=Object(l.a)(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(A,"/").concat(R,"/0/").concat(e)).then((function(t){return t.json()})).then((function(t){return t.hasOwnProperty("error")?[]:t})).then((function(t){return t.map((function(t){return new F(t.id)}))}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"fetchFiles",value:function(){var t=Object(l.a)(c.a.mark((function t(e,n){var r,a=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(A,"/").concat(R,"/0/").concat(e,"/").concat(n.id)).then((function(t){return t.json()})).then((function(t){return t.hasOwnProperty("error")?[]:t.posts}));case 2:return r=t.sent,t.abrupt("return",r.flatMap((function(t){return t.files.map((function(t){return new B(t.full,t.thumbnail,t.kind,t.name)}))})).filter((function(t){return"video"===t.kind})).filter((function(t){return!a.state.isIOS||t.full.endsWith("mp4")})));case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"continuousPreload",value:function(){var t=Object(l.a)(c.a.mark((function t(){var e,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.state.threadsCursor<this.state.threads.length)){t.next=11;break}return console.log(this.state.playlist.length),e=this.state.threads[this.state.threadsCursor],t.next=5,this.fetchFiles(this.state.board,e);case 5:return n=t.sent,this.setState({playlist:[].concat(Object(s.a)(this.state.playlist),Object(s.a)(y()(n))),threadsCursor:this.state.threadsCursor+1}),t.next=9,new Promise((function(t){return setTimeout(t,500)}));case 9:t.next=0;break;case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var t=Object(l.a)(c.a.mark((function t(e,n){var r=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.board!==this.state.board){t.next=2;break}return t.abrupt("return");case 2:this.setState({playlist:[]}),this.fetchThreads(this.state.board).then(function(){var t=Object(l.a)(c.a.mark((function t(e){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,r.fetchFiles(r.state.board,e[0]);case 4:n=t.sent,r.setState({threads:y()(e),threadsCursor:0,playlist:n,playlistCursor:0});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=this.state,n=e.playlist[e.playlistCursor];return n?a.a.createElement(j,null,["b","mu","mov","vg"].map((function(e){return a.a.createElement(x,{key:e},a.a.createElement("span",{onClick:function(){return t.setState({board:e})},style:{color:t.state.board===e?"hotpink":"orange"}},"/".concat(e,"/")))})),a.a.createElement(L,{media:n,playing:this.state.playing,looping:this.state.looping,onPlay:this.onPlay.bind(this),onPause:this.onPause.bind(this),moveCursor:this.moveCursor.bind(this)}),a.a.createElement(N,{source:n.full,playing:this.state.playing,looping:this.state.looping,moveCursor:this.moveCursor.bind(this),toggleLoop:this.toggleLoop.bind(this)})):"Loading..."}}]),e}(a.a.Component);i.a.render(a.a.createElement(H,null),document.getElementById("root"))}},[[22,1,2]]]);
//# sourceMappingURL=main.2b70fc88.chunk.js.map